<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="./src/assets/logo.png" />
  <link rel="icon" type="image/x-icon" href=".src\assets\favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Saira:wght@100;200;400;900&display=swap"
    rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;400;700&display=swap" rel="stylesheet">
  <title>Cidade Flow</title>
</head>

<body>
  <div style="height: 100vh;" id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
  <script src="./src/vlibras.js"></script>
  <script>
    new window.VLibras.Widget('https://vlibras.gov.br/app');
  </script>
</body>

<script>
  const service = require("../services/userservice");
  const rules = require("../services/rules");

  export default {
    name: "Login",
    components: {
    },
    props: {

    },

    data: () => ({
      rules: rules,

      valid: false,
      busy: false,
      failedReason: null,

      email: "",
      password: "",
    }),


    methods: {
      submit: function () {
        this.busy = true;
        this.failedReason = null;

        return service
          .login(this.email, this.password, "")
          .then((user) => {
            this.$emit("successful", user);
          })
          .catch((ex) => {
            if (ex === "captcha") {
              this.failedReason = "Captcha validation failed.";
            } else if (ex === "invalid_password") {
              this.failedReason = "Invalid username or password.";
            } else if (ex === "not_found") {
              this.failedReason = "Username not found.";
            } else if (ex === "banned") {
              this.failedReason = "Address banned.";
            } else {
              this.failedReason = "Connection error.";
            }
          })
          .then(() => {
            this.busy = false;
          });
      }
    }
  };
</script>

</html>